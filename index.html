<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="styles.css"> 
</head>
<body>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
        <div id='image'></div>
        <!-- Hidden popup divs for each hotspot -->
        <div id="popup_Pyongyang" class="popup">
            <h3>Pyongyang 1910-1940</h3>
            <p>This is where harabaji grew up</p>
            <img src="" alt="">
        </div>
        <div id="popup_Seoul" class="popup">
            <h3>Seoul 1920</h3>
            <p>Halmoni childhood</p>
            <img src="" alt="">
        </div>
        <div id="popup_Busan" class="popup">
            <h3>Busan 1940</h3>
            <p>everybody fled here</p>
            <img src="" alt="">
        </div>
        <div id="popup_CA" class="popup">
            <h3>Moving to California!</h3>
            <p>made the decision to ... </p>
            <img src="" alt="">
        </div>
        <div id="popup_Anaheim" class="popup">
            <h3>Welcome to Anaheim</h3>
            <p>made the decision to ... </p>
            <img src="" alt="">
        </div>
        <button id="contButton">Continue</button>

    <script>
        var slides = ['Pyongyang', 'Seoul', 'Busan', 'CA','Anaheim', 'DowntownA', 
                        'EastA'];
        var slideIndex = 0;
        // var imageWidth = 100;
        // var imageHeight = 100;
        var imageWidth = 9728;
        var imageHeight = 5288;
        var aspectRatio = imageWidth / imageHeight;
        var zoomed = false;
        var hotspotId = "";
        // var clickedHotspots = {}; // Keep track of how many times each hotspot has been clicked
        var hotspots = [{
                id: 'Pyongyang',
                x: 170,
                y: 665,
                height: 500,
                width: 500,
                numClicks: 0
            }, { 
                id: 'Seoul',
                x: 170,
                y: 1700,
                height: 500,
                width: 500,
                numClicks: 0
            }
        ];
        $(window).resize(function() {
            positionHotSpots();
        });
        var positionHotSpots = function() {
            $('.hotspot').remove();
            var wi = 0,
                hi = 0;
            var r = $('#image').width() / $('#image').height();
            if (aspectRatio <= r) {
                wi = $('#image').width();
                hi = $('#image').width() / aspectRatio;
            } else {
                wi = $('#image').height() * aspectRatio;
                hi = $('#image').height();
            }
            var offsetTop = (hi - $('#image').height()) / 2;
            var offsetLeft = (wi - $('#image').width()) / 2;
            $.each(hotspots, function(i, h) {

                var x = (wi * h.x) / imageWidth;
                var y = (hi * h.y) / imageHeight;

                var ww = (wi * (h.width)) / imageWidth;
                var hh = (hi * (h.height)) / imageHeight;

                var hotspot = $('<div>').attr('id', h.id).addClass('hotspot').css({
                    top: y - offsetTop,
                    left: x - offsetLeft,
                    height: hh,
                    width: ww
                });
                $('body').append(hotspot);
            });

            // CLICKING ON HOTSPOTS AND ZOOMING IN
            $('.hotspot').click(function() {
                hotspotId = $(this).attr('id');
                var clickedHotspot = hotspots.find(function(hotspot) {
                        return hotspot.id === hotspotId;
                });
                if (!zoomed) {
                        zoomed = true;
                        zoomToHotspot(hotspotId);
                } else {
                    slideIndex = slides.indexOf(hotspotId); // get & store curr slide index TODO:: do I need this?
                    console.log(slideIndex);
                    $('.popup').hide(); //close curr popup
                    $('#contButton').show(); // show the continue button
                    clickedHotspot.numClicks++;
                    if (clickedHotspot.numClicks % 2 !== 0) {
                        $('#popup_' + hotspotId).show();
                    }
                }
            });
        };

        var zoomToHotspot = function(hotspotId) {
            var hotspot = $('#' + hotspotId);
            var x = hotspot.position().left + hotspot.width() / 2.5;
            var y = hotspot.position().top + hotspot.height() / 2.5;

            $('#image').css({
                'transform-origin': x + 'px ' + y + 'px',
                'transform': 'scale(2)' // Adjust the scale factor as needed
            });

            // Adjust the position of hotspots after zoom
            $('.hotspot').each(function() {
                var newX = ($(this).position().left - x) * 2.5 + x;
                var newY = ($(this).position().top - y) * 2.5 + y;
                var newWidth = $(this).width() * 2.5;
                var newHeight = $(this).height() * 2.5;
                $(this).css({
                        left: newX,
                        top: newY,
                        width: newWidth,
                        height: newHeight
                });
            });
        };
        positionHotSpots();

        // Continue button
        $('#contButton').click(function() {
            $('.popup').hide(); //hide curr popup if there is one
            // $('#contButton').show();
            if(slides[slideIndex] == 'Seoul') {
                // next slide is Pyongyang
                $('#popup_' + slides[0]).show();
                slides[0]; 
            } else if (slides[slideIndex] == 'Pyongyang') {
                // next slide is Seoul
                $('#popup_' + slides[1]).show();
            } else if (slides[slideIndex] == 'Anaheim') {
                anaheim();
            } else {
                // go to next slide
                console.log("here");
                $('#popup_' + slides[slideIndex]).show();
            }
            slideIndex++; 
            console.log("Slide index: " + slideIndex);
        });
        var anaheim = function() {
            // Set new background image
            var imgURL = "images/CA_Anaheim_287970_1965_24000_geo.png";
            // reset background scale and background align
            $('#image').css({
                "background-image": "url(" + imgURL +")",
                "background-position": "right",
                'transform': 'scale(1)' 
            });
            // hide all old hotspots
            $('.hotspot').each(function() {
                $(this).css({
                        display: none
                });
            });
        };

    </script>
</body>
</html>
